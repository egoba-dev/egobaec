{#
    フォーム共通部品
    
    使用例:
    {% include '@CarouselFeature/admin/partial/form_fields.twig' with {
        type: 'image_upload',
        field: form.images
    } %}
#}

{% if type == 'image_upload' %}
    {# 画像アップロード部品 #}
    <div class="form-group">
        {{ form_label(field) }}
        {{ form_widget(field, {
            'attr': {
                'class': 'form-control-file image-upload-input',
                'accept': 'image/*',
                'multiple': true
            }
        }) }}
        
        <div class="upload-dropzone mt-2" data-target="{{ field.vars.id }}">
            <div class="upload-message text-center py-4">
                <i class="fa fa-cloud-upload-alt fa-2x text-muted mb-2"></i>
                <p class="mb-1">ここに画像をドラッグ&ドロップ</p>
                <small class="text-muted">または、クリックしてファイルを選択</small>
                <div class="mt-2">
                    <small class="text-muted">
                        対応形式: JPEG, PNG, GIF, WebP | 最大: 10MB
                    </small>
                </div>
            </div>
        </div>
        
        {% if field.vars.errors|length > 0 %}
            <div class="invalid-feedback d-block">
                {{ form_errors(field) }}
            </div>
        {% endif %}
        
        {% if field.vars.help %}
            <small class="form-text text-muted">{{ field.vars.help }}</small>
        {% endif %}
    </div>

{% elseif type == 'link_settings' %}
    {# リンク設定部品 #}
    <div class="form-group">
        <label class="form-label">リンク設定</label>
        
        {# リンクタイプ選択 #}
        <div class="link-type-selection mb-3">
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="link_type" id="link_none" value="none" checked>
                <label class="form-check-label" for="link_none">
                    <i class="fa fa-ban text-muted"></i> リンクなし
                </label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="link_type" id="link_product" value="product">
                <label class="form-check-label" for="link_product">
                    <i class="fa fa-shopping-cart text-info"></i> 商品ページ
                </label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="link_type" id="link_external" value="external">
                <label class="form-check-label" for="link_external">
                    <i class="fa fa-external-link-alt text-warning"></i> 外部URL
                </label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="link_type" id="link_internal" value="internal">
                <label class="form-check-label" for="link_internal">
                    <i class="fa fa-link text-primary"></i> 内部ページ
                </label>
            </div>
        </div>
        
        {# 動的表示フィールド #}
        <div class="link-fields">
            <div class="link-field" data-type="product" style="display: none;">
                <div class="alert alert-info">
                    <i class="fa fa-info-circle"></i>
                    商品を選択すると、商品詳細ページへのリンクが自動生成されます。
                </div>
                <select class="form-control product-selector" name="product_id">
                    <option value="">商品を選択してください</option>
                </select>
            </div>
            
            <div class="link-field" data-type="external" style="display: none;">
                <div class="alert alert-warning">
                    <i class="fa fa-exclamation-triangle"></i>
                    外部サイトのURLを入力してください。新しいタブで開きます。
                </div>
                <input type="url" class="form-control" name="link_url" placeholder="https://example.com">
            </div>
            
            <div class="link-field" data-type="internal" style="display: none;">
                <div class="alert alert-primary">
                    <i class="fa fa-info-circle"></i>
                    サイト内のページパスを入力してください。
                </div>
                <input type="text" class="form-control" name="link_url" placeholder="/categories/1">
            </div>
        </div>
        
        {# リンクテキスト #}
        <div class="link-text-field mt-3" style="display: none;">
            <label class="form-label">ボタンテキスト</label>
            <input type="text" class="form-control" name="link_text" placeholder="詳細を見る">
            <small class="form-text text-muted">空の場合は自動で生成されます</small>
        </div>
    </div>

{% elseif type == 'rich_editor' %}
    {# リッチテキストエディター部品 #}
    <div class="form-group">
        {{ form_label(field) }}
        {{ form_widget(field, {
            'attr': {
                'class': 'form-control rich-editor',
                'rows': rows|default(8),
                'data-editor': 'richtext'
            }
        }) }}
        
        <div class="editor-toolbar mt-2">
            <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn btn-outline-secondary" data-action="bold" title="太字">
                    <i class="fa fa-bold"></i>
                </button>
                <button type="button" class="btn btn-outline-secondary" data-action="italic" title="斜体">
                    <i class="fa fa-italic"></i>
                </button>
                <button type="button" class="btn btn-outline-secondary" data-action="underline" title="下線">
                    <i class="fa fa-underline"></i>
                </button>
            </div>
            <div class="btn-group btn-group-sm ml-2" role="group">
                <button type="button" class="btn btn-outline-secondary" data-action="heading" title="見出し">
                    <i class="fa fa-heading"></i>
                </button>
                <button type="button" class="btn btn-outline-secondary" data-action="list" title="リスト">
                    <i class="fa fa-list-ul"></i>
                </button>
                <button type="button" class="btn btn-outline-secondary" data-action="link" title="リンク">
                    <i class="fa fa-link"></i>
                </button>
            </div>
        </div>
        
        {% if field.vars.errors|length > 0 %}
            <div class="invalid-feedback d-block">
                {{ form_errors(field) }}
            </div>
        {% endif %}
        
        {% if field.vars.help %}
            <small class="form-text text-muted">{{ field.vars.help }}</small>
        {% endif %}
    </div>

{% elseif type == 'status_select' %}
    {# ステータス選択部品 #}
    <div class="form-group">
        {{ form_label(field) }}
        <div class="status-select-wrapper">
            {{ form_widget(field, {
                'attr': {
                    'class': 'form-control status-select'
                }
            }) }}
            
            <div class="status-preview mt-2">
                <small class="text-muted">プレビュー:</small>
                <span class="status-preview-badge">
                    {% include '@CarouselFeature/admin/partial/status_badge.twig' with {status: 'draft'} %}
                </span>
            </div>
        </div>
        
        {% if field.vars.errors|length > 0 %}
            <div class="invalid-feedback d-block">
                {{ form_errors(field) }}
            </div>
        {% endif %}
    </div>

{% elseif type == 'datetime_picker' %}
    {# 日時選択部品 #}
    <div class="form-group">
        {{ form_label(field) }}
        <div class="input-group">
            {{ form_widget(field, {
                'attr': {
                    'class': 'form-control datepicker',
                    'autocomplete': 'off'
                }
            }) }}
            <div class="input-group-append">
                <span class="input-group-text">
                    <i class="fa fa-calendar"></i>
                </span>
            </div>
        </div>
        
        {% if field.vars.errors|length > 0 %}
            <div class="invalid-feedback d-block">
                {{ form_errors(field) }}
            </div>
        {% endif %}
        
        {% if field.vars.help %}
            <small class="form-text text-muted">{{ field.vars.help }}</small>
        {% endif %}
    </div>

{% else %}
    {# デフォルトフィールド #}
    <div class="form-group">
        {{ form_label(field) }}
        {{ form_widget(field, {
            'attr': {
                'class': 'form-control'
            }
        }) }}
        
        {% if field.vars.errors|length > 0 %}
            <div class="invalid-feedback d-block">
                {{ form_errors(field) }}
            </div>
        {% endif %}
        
        {% if field.vars.help %}
            <small class="form-text text-muted">{{ field.vars.help }}</small>
        {% endif %}
    </div>
{% endif %}